//! backbone-delta.js 0.1.0, https://github.com/Two-Screen/backbone-delta
//! © 2012 Stéphan Kochen, Angry Bytes. MIT licensed.
(function(){var e,t;typeof require!="undefined"?(e=require("underscore"),t=exports):(e=window._,t=window.BBDelta={}),t.curry=function(t){var n=t.Model,r=t.Collection,s=function(t,r,i){var s=t.attributes,o={},u;i||(i={});if(!r)return t;r instanceof n&&(r=r.attributes),r=e.clone(r);for(u in s)e.has(r,u)||(r[u]=void 0,o[u]=!0);if(!t.set(r,i))return!1;for(u in o)delete s[u];return t},o=function(t,n,r){var s={},o=[],u=[],a,f;r||(r={}),n=e.isArray(n)?n.slice():[n];for(i=0,length=n.length;i<length;i++){f=n[i]=t._prepareModel(n[i],r);if(!f)throw new Error("Can't add an invalid model to a collection");s[f.id]=!0,(t.get(f.id)?o:u).push(f)}return o.length===0?t.reset(n,r):(a=t.select(function(e){return!s[e.id]}),t.remove(a,r),e.each(o,function(e){t.get(e).reset(e,r)}),t.add(u,r),t)};return{resetModel:s,collectionDelta:o}},t.extend=function(e){var n=t.curry(e);e.Model.prototype.reset=function(e,t){n.resetModel(this,e,t)},e.Collection.prototype.delta=function(e,t){n.collectionDelta(this,e,t)}},typeof window!="undefined"&&window.Backbone&&t.extend(window.Backbone)})();